<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Report Civic Issue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Bootstrap CSS  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <!-- <style>
    
     #map {
  height: 400px;
  width: 70%;
  margin: 10px auto 0 auto; /* top, right, bottom, left 
  border: 1px solid #ccc;
  border-radius: 8px;
  display: block; /* ensures it's treated as a block-level element 
}
  </style> -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="container mt-4">
<ul class="bubbles">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
</ul>
<div class="container d-flex align-items-center justify-content-center vh-1000">
    <div class="card shadow-lg p-4" style="max-width: 1800px; width: 100%;">
  <h2 class="text-center">Report a Civic Issue</h2>
  
  <form method="POST" enctype="multipart/form-data" class="mt-3">
    <div class="mb-3">
      <label class="form-label">Problem</label>
      <input type="text" name="title" class="form-control" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Description</label>
      <textarea name="description" class="form-control"></textarea>
    </div>

    <!-- <div class="mb-3">
      <label class="form-label">Category</label>
      <input type="text" name="category" class="form-control">
    </div> -->
    <div class="mb-3">
  <label for="category" class="form-label">Category</label>
  <select name="category" id="category" class="form-control">
    <option value="">-- Select a category --</option>
    <option value="road">Road</option>
    <option value="garbage">Garbage</option>
    <option value="streetlight">Streetlight</option>
    <option value="water">Water</option>
    <option value="noise">Noise</option>
    <option value="pollution">Pollution</option>
    <option value="drainage">Drainage</option>
    <option value="other">Other</option>
  </select>

    <!-- <div class="mb-3">
      <label class="form-label">Address (optional)</label>
      <input type="text" name="location" class="form-control">
    </div> -->

     <!-- Hidden fields for coordinates  -->
    <input type="hidden" id="latitude" name="latitude">
    <input type="hidden" id="longitude" name="longitude">

    <p><b>Select Issue Location on Map:</b> (Click anywhere to drop a marker)</p>
    <div id="map"  ></div>
</div class="d-flex justify-content-center">
 <!-- Locate Me Button -->
    <div class="text-center mt-3">
      <button type="button" id="locateBtn" class="btn btn-success">üìç Use My Current Location</button>
    </div>
    <div class="mb-3">
  <label for="state">Select State:</label>
  <select id="state" name="state" class="form-select">
    <option value="">-- Select State --</option>
    <option value="India">India</option>
    <option value="Andhra Pradesh">Andhra Pradesh</option>
    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
    <option value="Assam">Assam</option>
    <option value="Bihar">Bihar</option>
    <option value="Chhattisgarh">Chhattisgarh</option>
    <option value="Goa">Goa</option>
    <option value="Gujarat">Gujarat</option>
    <option value="Haryana">Haryana</option>
    <option value="Himachal Pradesh">Himachal Pradesh</option>
    <option value="Jharkhand">Jharkhand</option>
    <option value="Karnataka">Karnataka</option>
    <option value="Kerala">Kerala</option>
    <option value="Madhya Pradesh">Madhya Pradesh</option>
    <option value="Maharashtra">Maharashtra</option>
    <option value="Manipur">Manipur</option>
    <option value="Meghalaya">Meghalaya</option>
    <option value="Mizoram">Mizoram</option>
    <option value="Nagaland">Nagaland</option>
    <option value="Odisha">Odisha</option>
    <option value="Punjab">Punjab</option>
    <option value="Rajasthan">Rajasthan</option>
    <option value="Sikkim">Sikkim</option>
    <option value="Tamil Nadu">Tamil Nadu</option>
    <option value="Telangana">Telangana</option>
    <option value="Tripura">Tripura</option>
    <option value="Uttar Pradesh">Uttar Pradesh</option>
    <option value="Uttarakhand">Uttarakhand</option>
    <option value="West Bengal">West Bengal</option>
    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
    <option value="Chandigarh">Chandigarh</option>
    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
    <option value="Delhi">Delhi</option>
    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
    <option value="Ladakh">Ladakh</option>
    <option value="Lakshadweep">Lakshadweep</option>
    <option value="Puducherry">Puducherry</option>
  </select>
</div>

   
<div class="mb-3">
      <label class="form-label">Address (optional)</label>
      <input type="text" name="location" class="form-control">
    </div>
    <div class="mb-3 mt-3">
      <label class="form-label">Upload Image</label>
      <input type="file" name="image" class="form-control">
    </div>

    <button type="submit" class="btn btn-primary">Submit Report</button>
  </form>

   <!-- Leaflet JS  -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
   <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script>
    // Initialize map (Default: India view)
    var map = L.map('map').setView([20.5937, 78.9629], 5);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    var marker;

    // Initialize the Geocoder Control
    var geocoder = L.Control.geocoder({
        defaultMarkGeocode: false,
        placeholder: 'Search for a location...', // Custom placeholder text
    }).on('markgeocode', function(e) {
        var latlng = e.geocode.center;
        map.setView(latlng, 15); // Center and zoom the map to the found location
        setMarker(latlng.lat, latlng.lng); // Call the function to set the marker
    }).addTo(map);

    // On map click, drop marker and save lat/lng
    map.on('click', function(e) {
      setMarker(e.latlng.lat, e.latlng.lng);
    });

    // Function to drop marker & update hidden fields
    function setMarker(lat, lng) {
      if (marker) {
        map.removeLayer(marker);
      }
      marker = L.marker([lat, lng]).addTo(map);
      marker.bindPopup("Selected Location").openPopup();
      document.getElementById('latitude').value = lat;
      document.getElementById('longitude').value = lng;
    
    // Reverse geocode to get state
    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
      .then(response => response.json())
      .then(data => {
        const state = data.address.state || data.address.region || '';
        document.getElementById('state').value = state;
      })
      .catch(error => {
        console.error("Reverse geocoding failed:", error);
      });
  }

    // Handle Locate Me button
    document.getElementById('locateBtn').addEventListener('click', function() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var lat = position.coords.latitude;
          var lng = position.coords.longitude;
          map.setView([lat, lng], 15); // Zoom in to user location
          setMarker(lat, lng);
        }, function(error) {
          alert("Error getting location: " + error.message);
        });
      } else {
        alert("Geolocation is not supported by your browser.");
      }
    });
  
  </script>
  <input type="hidden" name="state" value="{{ state }}">
  <div class="text-center mt-3">
    <a href="/" class="btn btn-secondary">Back to Home</a>
  </div>
    </div>
</div>

</body>
</html>